MyBatis 的数据库连接池是一个核心组件，它通过复用数据库连接来显著提升应用性能。下面这个表格汇总了 MyBatis 支持的三种数据源类型，帮你快速把握全局。

|数据源类型|核心机制|适用场景|
|---|---|---|
|**UNPOOLED**​|无连接池。每次请求都**新建和关闭**一个物理连接。|开发测试、简单应用或连接数极少的场景。|
|**POOLED**​|MyBatis **自带的连接池**。缓存并复用连接，管理连接生命周期。|绝大多数生产环境，需要**高并发和高性能**的场景。|
|**JNDI**​|从**应用服务器**（如 Tomcat、WebLogic）提供的连接池中查找数据源。|需要与应用服务器集成的 **Java EE 项目**。|

### 💡 POOLED 连接池如何工作

POOLED 是 MyBatis 自带的连接池实现，也是**最常用**的选择。它的核心价值在于通过复用连接，避免了频繁创建和销毁连接带来的巨大开销。其内部结构和工作流程可以通过下图直观展示：

```
flowchart TD
A[应用请求数据库连接] --> B{连接池中有<br>空闲连接?}
B -- 有 --> C[从空闲集合<br>取出一个连接]
C --> D[将其移至活动集合]
D --> E[返回此连接给应用]
B -- 无 --> F{活动连接数<br>已达上限?}
F -- 未达上限 --> G[通过UnpooledDataSource<br>创建新连接]
G --> D
F -- 已达上限 --> H[等待直至有连接被归还或超时]
H --> B
I[应用使用完毕调用.close] --> J[连接池拦截.close调用]
J --> K[将连接从活动集合移回空闲集合]
```

- **连接状态管理**：`PooledDataSource`内部通过 `PoolState`对象管理两个核心集合：`idleConnections`（空闲连接）和 `activeConnections`（活动连接），并记录各种运行状态统计。
    
- **连接代理机制**：连接池返回的并不是原始的 `Connection`对象，而是一个被 `PooledConnection`类封装后的**代理对象**。当你调用这个代理连接的 `close()`方法时，它并不会真正关闭物理连接，而是触发了代理逻辑，将连接**归还**到空闲池中，以备复用。
    

### ⚙️ 如何配置与使用

配置连接池主要在 MyBatis 的核心配置文件 `mybatis-config.xml`中完成。

**1. 基础配置**

在 `<dataSource>`标签中，通过 `type`属性指定使用哪种数据源。

```
<configuration>
    <environments default="development">
        <environment id="development">
            <transactionManager type="JDBC"/>
            <!-- 关键在此：设置 type="POOLED" -->
            <dataSource type="POOLED">
                <property name="driver" value="com.mysql.cj.jdbc.Driver"/>
                <property name="url" value="jdbc:mysql://localhost:3306/mydb"/>
                <property name="username" value="root"/>
                <property name="password" value="password"/>
            </dataSource>
        </environment>
    </environments>
</configuration>
```

**2. 优化连接池参数**

POOLED 数据源提供了一系列参数用于优化性能，你可以在 `<dataSource>`标签内通过 `<property>`子标签进行配置。

```
<dataSource type="POOLED">
    <!-- ... 基础数据库连接信息 ... -->
    <!-- 连接池优化参数 -->
    <property name="poolMaximumActiveConnections" value="20"/> <!-- 最大活动连接数 -->
    <property name="poolMaximumIdleConnections" value="10"/>  <!-- 最大空闲连接数 -->
    <property name="poolMaximumCheckoutTime" value="20000"/> <!-- 连接被占用的最长时间(毫秒) -->
    <property name="poolTimeToWait" value="20000"/>           <!-- 获取连接时的最大等待时间(毫秒) -->
</dataSource>
```

### 🔧 进阶：集成高性能连接池

除了使用 MyBatis 自带的 POOLED 连接池，你还可以轻松集成业界公认性能更佳的第三方连接池，如 **HikariCP**​ 或 **Druid**。

**以集成 HikariCP 为例：**

1. **添加 Maven 依赖**：
    
    ```
    <dependency>
        <groupId>com.zaxxer</groupId>
        <artifactId>HikariCP</artifactId>
        <version>5.0.1</version>
    </dependency>
    ```
    
2. **在配置文件中指定数据源类型为 HikariCP 的实现类**：
    
    ```
    <dataSource type="com.zaxxer.hikari.HikariDataSource">
        <property name="driverClassName" value="com.mysql.cj.jdbc.Driver"/>
        <property name="jdbcUrl" value="jdbc:mysql://localhost:3306/mydb"/>
        <property name="username" value="root"/>
        <property name="password" value="password"/>
        <!-- HikariCP 专属配置 -->
        <property name="maximumPoolSize" value="10"/>
        <property name="connectionTimeout" value="30000"/>
    </dataSource>
    ```
    

### 💎 核心价值总结

总而言之，MyBatis 的连接池（特别是 `POOLED`类型）通过**连接复用、统一管理和监控**，极大地提升了应用程序的响应速度、可伸缩性和稳定性，是生产环境部署不可或缺的一环。

希望这些解释能帮助你清晰地理解 MyBatis 的数据库连接池。如果你对特定配置的细节或第三方连接池的集成有进一步的疑问，我很乐意继续探讨。