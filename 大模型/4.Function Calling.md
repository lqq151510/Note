Function Calling（函数调用）是大模型（特别是对话式AI）实现**与外部工具、API或代码交互**的核心机制。它让模型从“只能聊天”变为“可以实际操作”，是构建**AI Agent**的关键技术。

简单说，它允许你**告诉模型有哪些工具可用**，模型在对话中会**智能判断何时该调用哪个工具**，并**返回结构化的调用参数**，然后由**你的程序去真正执行这个调用**，最后将结果返回给模型进行总结回复。

### 核心概念：不是模型直接执行，而是生成调用指令

**关键点**：大模型本身**并不直接运行代码或调用API**。它只是根据你的描述，在认为需要时，输出一个格式化的、包含函数名和参数的JSON对象。真正的执行发生在你的代码或系统中。

### 基本工作流程（以“查询北京天气”为例）

1. **定义工具**：你告诉模型有哪些函数可用，包括函数名、描述、参数详情。
    
    ```
    {
      "name": "get_current_weather",
      "description": "获取指定城市的当前天气",
      "parameters": {
        "type": "object",
        "properties": {
          "location": {
            "type": "string",
            "description": "城市名称，例如：北京，上海"
          }
        },
        "required": ["location"]
      }
    }
    ```
    
2. **用户提问**：用户说：“北京今天天气怎么样？”
    
3. **模型决策与结构化输出**：模型理解意图后，不是直接生成回答，而是输出一个结构化的调用请求：
    
    ```
    {
      "function_call": {
        "name": "get_current_weather",
        "arguments": "{\"location\": \"北京\"}"
      }
    }
    ```
    
4. **外部执行**：你的程序收到这个JSON后，**实际调用**本地的 `get_current_weather("北京")`函数或外部的天气API，获取真实数据（如：`{“temperature”: 22, “condition”: “晴”}`）。
    
5. **结果返回与最终回复**：你将执行结果（天气数据）再次传给模型。模型结合对话历史和结果，生成对用户友好的最终回复：“北京今天天气晴朗，气温22摄氏度。”
    

### 与普通对话/提示词的核心区别

|特性|**普通对话**​|**使用 Function Calling**​|
|---|---|---|
|**输出内容**​|直接的自然语言文本。|大部分时间是自然语言，**在需要时会输出严格的JSON调用指令**。|
|**能力范围**​|局限于模型内部知识（可能有旧/不准确信息）。|**可触达实时、精准的外部世界信息和服务**（数据库、计算器、搜索引擎、企业内部系统）。|
|**可靠性**​|可能“胡编乱造”（幻觉）。|对于事实性数据（如股价、天气），因来自可靠信源，结果**更精确可靠**。|
|**用途**​|聊天、创作、分析已有文本。|**实现AI Agent的“行动”能力**，完成需要与外部系统交互的复杂任务（订票、数据分析、设备控制）。|

### 主要应用场景

1. **数据查询**：连接数据库、搜索引擎、股票/天气API。
    
2. **计算与工具**：使用计算器、单位转换器、代码解释器。
    
3. **操作执行**：发送邮件、创建日历事件、控制智能家居。
    
4. **复杂任务规划**：作为AI Agent的“大脑”，通过多次调用不同函数，完成多步骤任务（如：“订一家下周二人均500元左右的意大利餐厅，并邮件通知团队”）。
    

### 给开发者的提示

- **OpenAI、Anthropic、DeepSeek等主流模型**都提供了官方的Function Calling能力（名称可能略有不同，如“工具调用”）。
    
- 你需要在其API调用中，在消息参数里额外传入一个 `tools`(或 `functions`) 数组来定义可用工具。
    
- **安全至关重要**：你定义的工具列表就是模型能操作的“权限范围”。必须仔细审核和限制，防止模型请求调用危险或未授权的函数。
    

**总结**：Function Calling 是大模型与真实世界之间的“桥梁”。它让模型从“思考者”变成了“指挥者”，通过输出标准化的指令来驱动外部工具完成任务，是实现智能、自动化AI Agent的基石技术。